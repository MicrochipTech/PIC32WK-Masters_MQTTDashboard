var pahoClient;!function(){freeboard.loadDatasourcePlugin({type_name:"paho_mqtt",display_name:"Paho MQTT",description:"Receive data from an MQTT server.",external_scripts:["plugins/mqtt/mqttws31.min.js"],settings:[{name:"server",display_name:"MQTT Server",type:"text",default_value:window.location.hostname,description:"Hostname for your MQTT Server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:443,description:"The port to connect to the MQTT Server on",required:!0},{name:"use_ssl",display_name:"Use SSL",type:"boolean",description:"Use SSL/TLS to connect to the MQTT Server",default_value:!1},{name:"client_id",display_name:"Client Id",type:"text",default_value:"",required:!1},{name:"username",display_name:"Username",type:"text",default_value:"",required:!1},{name:"password",display_name:"Password",type:"text",default_value:"",required:!1},{name:"topic",display_name:"Topic",type:"text",description:"The topic to subscribe to",required:!0},{name:"json_data",display_name:"JSON messages?",type:"boolean",description:"If the messages on your topic are in JSON format they will be parsed so the individual fields can be used in freeboard widgets",default_value:!0}],newInstance:function(n,t,o){t(new e(n,o))}});var e=function(e,n){function t(){console.log("Connected to server"),pahoClient.subscribe(r.topic),"function"==typeof refreshPanels&&refreshPanels()}function o(e){0!==e.errorCode&&console.log("onConnectionLost:"+e.errorMessage)}function a(e){i.topic=e.destinationName,r.json_data?i.msg=JSON.parse(e.payloadString):i.msg=e.payloadString,n(i)}var s=this,i={},r=e;s.onSettingsChanged=function(e){pahoClient.disconnect(),i={},r=e,pahoClient.connect({onSuccess:t,userName:r.username,password:r.password,useSSL:r.use_ssl})},s.updateNow=function(){},s.onDispose=function(){pahoClient.isConnected()&&pahoClient.disconnect(),pahoClient={}},r.server=window.location.hostname,pahoClient=new Paho.MQTT.Client(r.server,r.port,r.client_id),pahoClient.onConnectionLost=o,pahoClient.onMessageArrived=a,pahoClient.connect({onSuccess:t,userName:r.username,password:r.password,useSSL:r.use_ssl})}}();
